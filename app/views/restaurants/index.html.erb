<% cache(cache_key_for_restaurants_table) do %>
<br/>
<div class="panel panel-default">
    <div class="panel-heading">
        <b>Restaurants</b>
    </div>
    
    <div class="panel-body">
        <div class="row">
            <% @restaurants.each do |restaurant| %>
            <% cache(cache_key_for_restaurant_row(restaurant)) do %>
                <% @comments = restaurant.comments %>
                <% avg_rating = 0%>
                <% count = 0%>
                <% @comments.each do |comment|%>
                    <% avg_rating = avg_rating+comment.rating%>
                    <% count = count+1%>
                <%end%>
            <div class="col-lg-4">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <%= link_to restaurant.name, restaurant_path(restaurant) %>  
                        <!--<span class = "pull-right">$<%#= restaurant.distance_to(@address) %></span>-->
                    </div>
                    <div class="panel-body">
                        <b>Avg Rating:</b> <%= number_with_precision(avg_rating*1.0/count, :precision => 2) %> <br/>
                        <b>Address:</b> <%= restaurant.address %> <br/>
                        <b>Zip Code:</b> <%= restaurant.zip %><br/>
                        <b>Phone:</b> <%= restaurant.phone %>
                    </div>
                </div>
            </div>
            <% end %>
            <% end %>
            <!-- /.col-lg-4 -->
        </div>
    </div>
    <!-- /.panel-body -->
</div>
<% end %>

